# waterline_detection

## 개발의도

올해 장마가 정말 길어지고 있다. 

전국적으로 정말 많은 양의 비가 오고 있는데, 일기예보에서는 대략적인 지역의 강수량 평균 정보에 대해서만 알려준다.

당장 내 집 앞에 대한 강수량 수위 측정은 불가능하다.

더 세부적인 강수량 정보가 필요한 경우(예를 들어 농가, 습도나 강수량에 민감한 공장 등) 해당 지역에 더 정확한 강수량 정보를 실시간으로 알려줄 수 있으면 좋겠다는 생각이 들었다.

만약 카메라를 통해 실시간으로 데이터 수위 측정 데이터가 전송되고 일정량이 넘어가면 알려줄 수 있다면 좋을 것이라는 생각이 들었다.



## 개발 과정

opencv를 활용한 방법을 찾아보다 카메라에 찍힌 화면의 색깔을 구분하고 찾아주는 코드를 찾게 되었다. 

참고한 코드를 바로 사용하려했지만 환경에 대한 노이즈가 최적화되지 않았다. 

노이즈를 최소화하기 위해 조명환경에 맞게 여러번 실행해보았고, 코드내에서는 모폴로지 연산에 대한 파라미터 값 또한 여러번 실행해보며 가장 나은 값을 찾아갔다.

수위를 측정하기 위해 물체에 Bounding Box를 그려주었고 만들어진 ROI 값에서 height 부분을 출력하는 코드를 추가하였다. (이 Bounding Box를 그리는 기준 또한 조명에 따라 바꿔주었다.)

캠을 끄고 창까지 같이 꺼지도록 코드를 수정하였다.



정보를 사용하려는 사용자에게 정보전달을 실시간으로 전달하기 위해서 Blynk 앱을 사용하였다.

Blynk 앱은 IoT 앱을 개발하기 용이한 툴이며, 라즈베리파이나 Node MCU 등과 연결하여 사용 가능하다.

Blynk 앱에서는 수위측정에 대한 정보를 숫자와, 시계열 그래프를 실시간으로 시각화해서 보여준다.

여기에 더해, 임의로 측정값이 200을 넘어가게 되면 해당 앱 사용자에게 자동으로 알려줄 수 있는 기능을 추가하였다. (2020.08.13)


## 한계점

노이즈를 없애고 더욱 정확한 수위측정을 위해서는 딥러닝 기술을 활용할 필요성을 느꼈다.

하지만 개발 플랫폼이 라즈베리파이였고, opencv를 활용한 카메라 데이터를 전송하는데만 해도 어느정도의 지연이 발생하였기 때문에 사용하지 못하였다.

환경에 대해 민감하게 결과가 바뀌어 환경이 바뀌면 파라미터를 변경해줄 필요가 있다.

수위 측정의 단위는 픽셀단위였기 때문에 cm 단위로 정확하게 환산하기 위해선 카메라와 대상 물체간의 거리를 수학적으로 정확히 계산할 필요가 있다.



참고한 블로그 -> https://webnautes.tistory.com/1246 
참고한 깃허브 -> https://github.com/webnautes/nudapeu/blob/master/opencv-python-006.py  (2020/8/4)
